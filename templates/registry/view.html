{{ define "registry/view.html" }}
    {{template "header" .}}
<div class="registry" id="registry-view">
    <div class="registry-header">
        <a href="{{ .BasePath }}/admin/registry/overview" class="registry-add">
            <img alt="add registry" src="{{ .BasePath }}/static/img/action-back.png" />
            <span>НАЗАД</span>
        </a>
    </div>
    <div class="registry-header registry-header-view">
        <h1>Реєстр "{{.registry.Name}}"</h1>
        {{if .allowedToEdit}}
        <a href="{{ .BasePath }}/admin/registry/edit/{{.registry.Name}}" class="registry-add">
            <img alt="add registry" src="{{ .BasePath }}/static/img/action-edit.png" />
            <span>Редагувати</span>
        </a>
        {{end}}
    </div>
    <div class="registry-description">Інформація про реєстр.</div>

    <div class="rg-info-block">
        <div class="rg-info-block-header">
            <span>Загальна інформація</span>
            <img src="{{ .BasePath }}/static/img/action-toggle.png" alt="toggle block" />
        </div>
        <div class="rg-info-block-body">
            <div class="rg-info-line-horizontal">
                <span>Назва</span>
                <span>{{ .registry.Name }}</span>
            </div>
            {{if .registry.Description}}
            <div class="rg-info-line-horizontal">
                <span>Опис</span>
                <span>{{ .registry.Description }}</span>
            </div>
            {{end}}
            {{if .admins }}
                <div class="rg-info-line-horizontal">
                    <span>Адміністратори</span>
                    <span>{{ .admins }}</span>
                </div>
            {{end}}
            <div class="rg-info-line-horizontal">
                <span>Час створення</span>
                <span>{{ .registry.FormattedCreatedAtTimezone $.timezone }}</span>
            </div>
        </div>
    </div>
    <div class="rg-info-block">
        <div class="rg-info-block-header">
            <span>Доступ для реєстрів платформи та зовнішніх систем</span>
            <img src="{{ .BasePath }}/static/img/action-toggle.png" alt="toggle block" />
        </div>
        <div class="rg-info-block-body">
            <table class="rg-info-table rg-info-table-config">
                <thead>
                <tr>
                    <th>Статус</th>
                    <th>Назва</th>
                    <th>Тип системи</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <img alt="status" src="{{ $.BasePath }}/static/img/status-inactive.png" />
                        </td>
                        <td>
                            Reg-name-2
                        </td>
                        <td>
                            Зовнішня система
                        </td>
                        <td>
                            <div class="rg-external-system-actions">
                                <a href="#">
                                    <img alt="key" src="{{ $.BasePath }}/static/img/key.png" />
                                </a>
                                <a href="#">
                                    <img alt="key" src="{{ $.BasePath }}/static/img/lock.png" />
                                </a>
                                <a href="#">
                                    <img alt="key" src="{{ $.BasePath }}/static/img/disable.png" />
                                </a>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- <div class="rg-info-block-no-content">
                Немає реєстрів або систем, що мають доступ до цього реєстра.
            </div> -->

            <div class="link-grant-access">
                <a class="" href="#" @click="showExternalReg">
                    <img alt="Надати доступ" src="{{ .BasePath }}/static/img/plus.png" />
                    <span>Надати доступ</span>
                </a>
            </div>
        </div>
    </div>
    {{if .branches }}
    <div class="rg-info-block">
        <div class="rg-info-block-header">
            <span>Конфігурація</span>
            <img src="{{ .BasePath }}/static/img/action-toggle.png" alt="toggle block" />
        </div>
        <div class="rg-info-block-body">
            <table class="rg-info-table rg-info-table-config">
                <thead>
                <tr>
                    <th>Статус</th>
                    <th>Конфігурація</th>
                    <th>VCS</th>
                    <th>CI</th>
                    <th>Версія</th>
                    <th>Номер збірки</th>
                    <th>Остання вдала збірка</th>
                </tr>
                </thead>
                <tbody>
                {{range $index, $br := .branches}}
                <tr>
                    <td>
                        <img alt="status" src="{{ $.BasePath }}/static/img/status-{{$br.Status.Value}}.png" />
                    </td>
                    <td>
                        {{$br.Name}}
                    </td>
                    <td>
                        <a href="{{ $br.CreateGerritLink $.gerritURL }}" target="_blank">
                            <img alt="vcs" src="{{ $.BasePath }}/static/img/action-link.png" />
                        </a>
                    </td>
                    <td>
                        <a href="{{ $br.CreateJenkinsLink $.jenkinsURL }}" target="_blank">
                            <img alt="ci" src="{{ $.BasePath }}/static/img/action-link.png" />
                        </a>
                    </td>
                    <td>{{$br.Spec.Version}}</td>
                    <td>{{$br.Status.Build}}</td>
                    <td>{{if $br.Status.LastSuccessfulBuild}}{{$br.Status.LastSuccessfulBuild}}{{else}}-{{end}}</td>
                </tr>
                {{end}}
                </tbody>
            </table>
        </div>
    </div>
    {{end}}
    {{if .actionLog}}
    <div class="rg-info-block">
        <div class="rg-info-block-header">
            <span>Журнал подій</span>
            <img src="{{ .BasePath }}/static/img/action-toggle.png" alt="toggle block" />
        </div>
        <div class="rg-info-block-body">
            <table class="rg-info-table rg-info-table-config">
                <thead>
                <tr>
                    <th>Дата</th>
                    <th>Користувач</th>
                    <th>Дія</th>
                    <th>Результат</th>
                    <th>Повідомлення</th>
                </tr>
                </thead>
                <tbody>
                {{range $index, $al := .registry.ActionLog}}
                <tr>
                    <td>{{$al.FormattedLastTimeUpdate}}</td>
                    <td>{{$al.UserName}}</td>
                    <td>{{$al.Action}}</td>
                    <td>{{$al.Result}}</td>
                    <td>{{$al.Message}}</td>
                </tr>
                {{end}}
                </tbody>
            </table>
        </div>
    </div>
    {{end}}
    {{ if .mergeRequests}}
        <div class="rg-info-block">
            <div class="rg-info-block-header">
                <span>Запити на оновлення</span>
                <img src="{{ .BasePath }}/static/img/action-toggle.png" alt="toggle block" />
            </div>
            <div class="rg-info-block-body">
                <table class="rg-info-table rg-info-table-config">
                    <thead>
                    <tr>
                        <th>Дата</th>
                        <th>Назва</th>
                        <th>Статус</th>
                        <th>Посилання</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{range $index, $al := .mergeRequests}}
                        <tr>
                            <td>{{$al.FormattedCreatedAt}}</td>
                            <td>{{$al.Name}}</td>
                            <td>{{$al.Status.Value}}</td>
                            <td>
                                {{if $al.Status.ChangeURL}}
                                    <a href="{{$al.Status.ChangeURL}}" target="_blank">
                                        <img alt="vcs" src="{{ $.BasePath }}/static/img/action-link.png" />
                                    </a>
                                {{end}}
                            </td>
                        </tr>
                    {{end}}
                    </tbody>
                </table>
            </div>
        </div>
    {{end}}
    {{ if .edpComponents}}
    <div class="dashboard-panel registry-dashboard-panel">
        <ul>
            {{range $index, $ec := .edpComponents}}
            <li>
                <img src="data:image/svg+xml;base64,{{$ec.Spec.Icon}}" alt="{{$ec.Spec.Type}} logo" />
                <div class="dashboard-item-content">
                    <a target="_blank" href="{{$ec.Spec.Url}}">{{$ec.Spec.Type}} <img src="{{$.BasePath}}/static/img/action-link.png"
                                                                      alt="{{$ec.Spec.Type}} link"></a>
                </div>
            </li>
            {{end}}
        </ul>
    </div>
    {{end}}


    <div class="popup-backdrop visible" v-cloak v-if="externalRegPopupShow"></div>
    <div id="external-reg-popup" class="popup-window admin-window external-reg-window visible" v-cloak v-if="externalRegPopupShow">
        <div class="popup-header">
            <p>Надати доступ</p>
            <a href="#" @click="hideExternalReg" class="popup-close hide-popup">
                <img alt="close popup window" src="{{.BasePath}}/static/img/close.png" />
            </a>
        </div>
        <form @submit="addExternalReg" id="external-reg-form" method="post"
              action="{{ .BasePath }}/admin/registry/external-reg-add/{{.registry.Name}}">
            <div class="popup-body">
                <p class="popup-error" v-cloak v-if="accessGrantError">Всі поля обов'язкові для заповнення</p>

                <p>
                    Ви можете надати доступ до даних цього реєстру (master) іншим реєстрам на цій платформі або
                    зовнішнім системам (clients). Для цього в мастер-реєстрі буде створено окремого користувача
                    реєстра-клієнта, від імені якого здійснюватеметься доступ до мастер-реєстру.
                </p>
                <div class="er-radio">
                    <div @click="setInternalRegistryReg">
                        <span class="er-radio-button" :class="{ selected: internalRegistryReg }"></span>
                        <span class="er-radio-text">Внутрішній реєстр платформи</span>
                    </div>
                    <div @click="setExternalSystem">
                        <span class="er-radio-button" :class="{ selected: !internalRegistryReg }"></span>
                        <span class="er-radio-text">Зовнішня система</span>
                    </div>
                    <input type="hidden" :value="externalSystemType" name="external-system-type" />
                </div>
                <div v-if="internalRegistryReg" class="er-system-opts">
                    <label for="in-registry">Оберіть реєстр</label>
                    <select name="reg-name" id="in-registry">
                        {{range $index, $ar := .externalRegAvailableRegistries}}
                            <option>{{$ar.Name}}</option>
                        {{end}}
                    </select>
                    <span>Якщо реєстру не має в переліку – його потрібно створити заздалегідь.</span>
                </div>
                <div v-if="!internalRegistryReg" class="er-system-opts">
                    <label for="ex-system">Назва системи</label>
                    <input required name="reg-name" id="ex-system" placeholder="Введіть назву" maxlength="32"
                           pattern="^[a-zA-Z0-9-]+$" />
                    <span>Допустимі символи: “a-z”, “-”. Назва не може перевищувати довжину у 32 символів.</span>
                    <label>Пароль доступу</label>
                    <p>Пароль буде створено автоматично. Його можна буде перевірити після налагодження доступу до мастер-реєстру.</p>
                </div>

            </div>
            <div class="popup-footer active">
                <a href="#" id="external-reg-cancel" class="hide-popup" @click="hideExternalReg">відмінити</a>
                <button value="submit" name="external-reg-apply" @click="addExternalReg" type="submit">Надати</button>
            </div>
        </form>
    </div>

</div>

    {{template "scripts" .}}
    <script type="text/javascript" src="{{.BasePath}}/static/js/view-registry.js"></script>
    {{template "footer" .}}

{{ end }}