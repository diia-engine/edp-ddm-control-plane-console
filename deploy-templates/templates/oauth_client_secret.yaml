{{ $secret := (lookup "v1" "Secret" .Release.Namespace {{ .Values.oauthclientName }}) }}
{{ $oauthclientSecret := randAlphaNum 16 }}

---
apiVersion: oauth.openshift.io/v1
grantMethod: auto
kind: OAuthClient
metadata:
  name: admin-console-client
redirectURIs:
  - https://{{ .Values.name }}-{{ .Values.edpProject }}.{{ .Values.dnsWildcard }}/auth/callback
  - http://localhost:8080/auth/callback
secret: {{ if .Values.oauthclientSecret }}{{ .Values.oauthclientSecret }}{{ else }}{{ if $secret }}{{ b64dec $secret.data.secret }}{{ else }}{{ $oauthclientSecret }}{{ end }}{{ end }}

---

kind: Secret
apiVersion: v1
metadata:
  name: {{ .Values.oauthclientName }}
data:
  clientId: YWRtaW4tY29uc29sZS1jbGllbnQ=
  secret: {{ if .Values.oauthclientSecret }}{{ b64enc .Values.oauthclientSecret }}{{ else }}{{ if $secret }}{{ $secret.data.secret }}{{ else }}{{ b64enc $oauthclientSecret }}{{ end }}{{ end }}
type: Opaque